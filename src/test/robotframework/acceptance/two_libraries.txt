*** Settings ***
Library         String
Library         JMSLibrary  ${INITIAL_CONTEXT_FACTORY}  ${PROVIDER_URL}  WITH NAME  jms1
Library         JMSLibrary  ${INITIAL_CONTEXT_FACTORY}  ${PROVIDER_URL}  WITH NAME  jms2
Suite Setup     Initialize Suite
Suite Teardown  Deinitialize Suite

*** Variables ***
${INITIAL_CONTEXT_FACTORY}  org.apache.activemq.jndi.ActiveMQInitialContextFactory
${PROVIDER_URL}             tcp://localhost:61616?jms.useAsyncSend=false
${QUEUE}                    QUEUE.JMSLIBRARY.TEST
${TOPIC}                    TOPIC.JMSLIBRARY.TEST

*** Test Cases ***
Queue Send and Receive TextMessage
    [Setup]  jms1.Clear Queue Once  ${QUEUE}
    ${text}=  Generate Random String
    jms1.Create Text Message  ${text}
    jms1.Send To Queue  ${QUEUE}
    jms2.Receive Once From Queue  ${QUEUE}
    ${body}=  jms2.Get Text
    Should Be Equal  ${body}  ${text}
    [Teardown]  jms1.Clear Queue Once  ${QUEUE}

Topic Send and Receive TextMessage
    [Setup]  jms2.Init Topic Consumer  ${TOPIC}
    ${text}=  Generate Random String
    jms1.Create Text Message  ${text}
    jms1.Send To Topic  ${TOPIC}
    jms2.Receive
    ${body}=  jms2.Get Text
    Should Be Equal  ${body}  ${text}
    [Teardown]  jms2.Close Consumer

*** Keywords ***
Initialize Suite
    jms1.Connect And Start
    jms2.Connect And Start

Deinitialize Suite
    jms1.Close Connection
    jms2.Close Connection
